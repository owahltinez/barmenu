<html>

<head>
  <title>{{ menu }}</title>
  <link rel="icon" type="image/jpeg" href="logo.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="//unpkg.com/js-yaml"></script>
  <script src="//unpkg.com/mancha@0.8.44" css="utils" init defer></script>
</head>

<body :data="{ items: [] }" class="bg-blue-gray-50 font-sans p-4 flex flex-col justify-center items-center">

  <include src="./header.tpl.html"></include>

  <main class="mx-8 mt-0 md:mt-8 max-w-1024px">

    <div class="flex flex-wrap justify-center gap-4 mt-4">
      <div :for="item in items" class="p-4 w-60 min-h-32 border border-2 border-blue-gray-300 bg-gray-200 rounded-md">

        <div class="mb-2">
          <h3 class="m-0 mb-2">{{ item.name }}</h3>
          <small class="block">{{ item.description }}</small>
        </div>

        <div>
          <details class="pt-2">
            <summary class="cursor-pointer hover:underline transition">Ingredients</summary>
            <ul class="-ml-4 mt-1 mb-0">
              <li :for="entry in Object.entries(item.ingredients)">
                <small>{{ entry[0] }}: {{ entry[1] }}</small>
              </li>
            </ul>
          </details>

          <details class="pt-2">
            <summary class="cursor-pointer hover:underline transition">Instructions</summary>
            <ul class="-ml-4 mt-1 mb-0">
              <li :for="step in item.instructions">
                <small>{{ step }}</small>
              </li>
            </ul>
          </details>
        </div>

      </div>
    </div>
  </main>
</body>


<script type="module">
  const params = new URL(window.location.href).searchParams;
  const menuName = params.get('menu');
  window.document.title = `${menuName[0].toUpperCase() + menuName.slice(1)} Menu`;

  const fetchYaml = async (url) => {
    const res = await fetch(url);
    const text = await res.text();
    return jsyaml.load(text);
  }

  const { $ } = Mancha;
  const index = await fetchYaml(`recipes/${menuName}/index.yml`);
  $.items = await Promise.all(index.map(x => fetchYaml(`recipes/${menuName}/${x}.yml`)));
</script>


</html>